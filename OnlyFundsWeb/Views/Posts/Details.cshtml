@using BusinessObjects
@using DataAccess.IRepository
@using DataAccess.Repository
@using Microsoft.AspNetCore.Http
@model BusinessObjects.Post
@{
    ViewData["Title"] = "Details";
    string currentUsername = Context.Session.GetString("user");
    Layout = "~/Views/Shared/_userLayout.cshtml";
    IEnumerable<Comment> comments = ViewBag.Comments as IEnumerable<Comment>;
    bool reported = false;
    if (!currentUsername.Equals(Model.UploaderUsername))
    {
        IReportRepository reportRepo = new ReportRepository();
        IEnumerable<PostReport> reports = reportRepo.GetReportsByPost(Model.PostId);
        foreach (var report in reports)
        {
            if (report.ReporterUsername.Equals(currentUsername))
            {
                reported = true;
                break;
            }
        }
    }
}
<head>
    <link rel="stylesheet" href="~/css/post_detail.css"/>
</head>
<!-- Main content -->
<main class="mt-3">
    <div class="container w-75 pt-3">
        <h3 class="text-center">@Model.PostTitle</h3>

        <div class="row">
            <!-- Date here -->
            <div class="col ps-0 fw-bold" style="font-size: 17px;">
                @Model.UploadDate.Value.ToString("dd-MMM-yyyy")
            </div>
        </div>
        <div class="row border border-dark rounded p-3 mb-5">
            <div class="col-12 pb-3 text-break" id="post-content">
                @Model.PostDescription
            </div>
            @{
                if (!string.IsNullOrEmpty(Model.FileUrl))
                {
                    <div class="col-12 pb-3">
                        <i class="fas fa-paperclip" style="transform: scale(0.8);"></i>
                        <a href="~/postfiles/@Model.FileUrl" class="add-on"
                           style="font-size: 17px; color: red; text-decoration: underline;">@Model.FileUrl</a>
                    </div>
                }
                <div class="col-12 pb-2 border-bottom" style="position: relative;" id="icon-bar">
                    <!-- Like button, đếm số like của 1 post -->
                    <a href="#AJAX" class="like me-4">
                        <i class="far fa-thumbs-up"></i>
                        421
                        <!-- Đã like thì chuyển thành nút này -->
                        <!-- <i class="fas fa-thumbs-up"></i> -->
                    </a>
                    <!-- Đếm số comment của post -->
                    <a href="#AJAX" class="comment">
                        <i class="fas fa-comment"></i>
                        110
                    </a>
                    <text>
                        <!-- Nếu user không phải author -->
                        @if (!Model.UploaderUsername.Equals(currentUsername))
                        {
                            @if (reported == false)
                            {
                                <a href="#" data-bs-toggle="modal" data-bs-target="#report-form" class="report"
                                   style="position: absolute; right: 0;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </a>
                                <div class="modal fade" id="report-form" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">Report post</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <form asp-action="Add" asp-controller="Report" method="Post"
                                                      asp-route-postid="@Model.PostId" id="report-form">
                                                    <div>
                                                        <label for="desc">Description</label>
                                                        <input type="text" name="desc" class="form-control" />
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <input type="submit" form="report-form" class="btn btn-primary" value="Submit" />
                                                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <span href="#" data-bs-toggle="tooltip" data-bs-placement="top"
                                      title="Tooltip on top style="position: absolute; right: 0;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </span>
                            }

                        }
                        else
                        {
                        <!-- Xoá post-->
                        <a href="#" class="me-4" data-bs-toggle="modal" data-bs-target="#modal-delete"
                           style="position: absolute; right: 0;">
                            <i class="fas fa-trash-alt"></i>
                        </a>
                        <!-- Sửa post-->
                        <a asp-controller="Posts" asp-action="Edit" asp-route-id="@Model.PostId" style="position: absolute; right: 0;">
                            <i class="fas fa-pencil-alt"></i>
                        </a>
                        <div class="modal fade" id="modal-delete" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Delete Post</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <h5>This action will delete: </h5>
                                        <ul>
                                            <li>All information of this post</li>
                                            <li>Comments of this post</li>
                                            <li>Likes of this post</li>
                                        </ul>
                                        <p class="text-danger">Are you sure you want to delete this post</p>
                                    </div>
                                    <div class="modal-footer">
                                        <form class="form-inline" asp-action="Delete" method="post"
                                              asp-route-id="@Model.PostId">
                                            <input type="submit" class="btn btn-danger" value="Delete" />
                                            <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                    aria-label="Close">
                                                Cancel
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        }
                    </text>
                </div>
                <!-- Write a comment -->
                <div class="comment-input mt-3">
                    <div class="comment-ava">
                        <img src="images/Avatar.png" alt="avatar">
                    </div>
                    <div class="comment-text">
                        <form action="#CommentServlet" method="post">
                            <input class="rounded-pill ps-2" type="text" placeholder="Write a comment...">
                        </form>
                    </div>
                </div>
                <!-- List of comments -->
                <div class="comment-list">
                    <div class="comment">
                        <div class="comment-ava">
                            <img src="images/Avatar.png" alt="avatar">
                        </div>
                        <div class="comment-body">
                            <div class="main-content border rounded p-2 pt-1">
                                <!-- Comment's author -->
                                <div class="comment-name">
                                    <a href="#author-page" class="info fw-bold" id="author-link">Wibu Dũng</a>
                                </div>
                                <!-- Comment's content -->
                                <p class="mb-0">
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
                                    temporincididunt
                                    ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation
                                    ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
                                    reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur
                                </p>
                            </div>
                            <!-- Icons -->
                            <ul class="p-0">
                                <li>
                                    <a href="#AJAX" class="like">
                                        <i class="far fa-thumbs-up"></i>
                                        421
                                        <!-- Đã like thì chuyển thành nút này -->
                                        <!-- <i class="fas fa-thumbs-up"></i> -->
                                    </a>
                                </li>
                                <li>
                                    <a href="#AJAX" class="report">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="comment">
                        <div class="comment-ava">
                            <img src="images/Avatar.png" alt="avatar">
                        </div>
                        <div class="comment-body">
                            <div class="main-content border rounded p-2 pt-1">
                                <!-- Comment's author -->
                                <div class="comment-name">
                                    <a href="#author-page" class="info fw-bold" id="author-link">Wibu Khôi</a>
                                </div>
                                <!-- Comment's content -->
                                <p class="mb-0">
                                    Visit my website to know how to become a golden frog
                                </p>
                            </div>
                            <!-- Icons -->
                            <ul class="p-0">
                                <li>
                                    <a href="#AJAX" class="like">
                                        <i class="far fa-thumbs-up"></i>
                                        421
                                        <!-- Đã like thì chuyển thành nút này -->
                                        <!-- <i class="fas fa-thumbs-up"></i> -->
                                    </a>
                                </li>
                                <li>
                                    <a href="#AJAX" class="report">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="comment">
                        <div class="comment-ava">
                            <img src="images/Avatar.png" alt="avatar">
                        </div>
                        <div class="comment-body">
                            <div class="main-content border rounded p-2 pt-1">
                                <!-- Comment's author -->
                                <div class="comment-name">
                                    <a href="#author-page" class="info fw-bold" id="author-link">Wibu Thái</a>
                                </div>
                                <!-- Comment's content -->
                                <p class="mb-0">
                                    お兄ちゃんのへんたい!
                                </p>
                            </div>
                            <!-- Icons -->
                            <ul class="p-0">
                                <li>
                                    <a href="#AJAX" class="like">
                                        <i class="far fa-thumbs-up"></i>
                                        421
                                        <!-- Đã like thì chuyển thành nút này -->
                                        <!-- <i class="fas fa-thumbs-up"></i> -->
                                    </a>
                                </li>
                                <li>
                                    <a href="#AJAX" class="report">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</main>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>
<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })
</script>
